{{ header }}{{ column_left }}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="container-fluid">
    <div id="progress"></div>
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-list"></i> {{ text_list }}</h3>
      </div>
      <div class="panel-body">
        <div class="table-responsive">
          <table id="itau-shopline" class="display table table-bordered table-hover" cellspacing="0" width="100%">
            <thead>
              <tr>
                <th class="text-center">{{ column_order_id }}</th>
                <th class="text-center">{{ column_date_added }}</th>
                <th class="text-left">{{ column_customer }}</th>
                <th class="text-center">{{ column_tipo }}</th>
                <th class="text-center">{{ column_valor }}</th>
                <th class="text-center">{{ column_pago_em }}</th>
                <th class="text-center">{{ column_autorizacao }}</th>
                <th class="text-center">{{ column_nsu }}</th>
                <th class="text-center">{{ column_situacao }}</th>
                <th style="min-width: 100px !important;" class="text-center">{{ column_action }}</th>
              </tr>
            </thead>
            <tbody>
              {% if transactions %}
              {% for transaction in transactions %}
              <tr>
                <td class="text-center"><a href="{{ transaction.view }}">{{ transaction.order_id }}</a></td>
                <td class="text-center">{{ transaction.date_added }}</td>
                <td class="text-left">{{ transaction.customer }}</td>
                <td class="text-center">{{ transaction.tipo }}</td>
                <td class="text-center">{{ transaction.valor }}</td>
                <td class="text-center">{{ transaction.data_pagamento }}</td>
                <td class="text-center">{{ transaction.autorizacao }}</td>
                <td class="text-center">{{ transaction.nsu }}</td>
                <td class="text-center">{{ transaction.situacao }}</td>
                <td class="text-center">
                  {% for action in transaction.action %}
                  <button type="button" data-toggle="tooltip" title="{{ action.title }}" class="{{ action.class }}" name="{{ action.name }}" id="{{ action.id }}"><i class="{{ action.icon }}"></i></button>
                  {% endfor %}
                </td>
              </tr>
              {% endfor %}
              {% else %}
              <tr>
                <td class="text-center" colspan="10">{{ text_no_results }}</td>
              </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <script type="text/javascript"><!--
    $(document).ready(function() {
      $('#itau-shopline').DataTable({
        "order": [],
        "columnDefs": [ {"targets": 9, "searchable": false, "orderable": false} ],
        "deferRender": true,
        "language": {
          "url": "//cdn.datatables.net/plug-ins/1.10.21/i18n/Portuguese-Brasil.json"
        }
      });
    });

    $('button[name="button-sonda"]').click(function() {
      var currentId = $(this).attr('id');
      $.ajax({ 
        url: 'index.php?route=extension/itau_shopline/search/consultar&user_token={{ user_token }}&order_id=' +  currentId,
        dataType: 'json',
        beforeSend: function() {
          $(this).prop('disabled', true);
          $('#progress').html('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ text_consultando }} <img src="view/image/itau_shopline/ajax-loader.gif" alt="" /><button type="button" class="close" data-dismiss="alert">&times;</button></div>');
          $('html, body').animate({ scrollTop: 0 }, 'slow');
        },
        complete: function() {
          $(this).prop('disabled', false);
        },
        success: function(json) {
          $('html, body').animate({ scrollTop: 0 }, 'slow');
          if (json['error']) {
            $('#progress').html('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + '<button type="button" class="close" data-dismiss="alert">&times;</button></div>');
          } else {
            $('.alert alert-danger').remove();
            $('#progress').html('<div class="alert alert-success"><i class="fa fa-check-circle"></i> ' + json['message'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
            location.href = location.href;
          }
        }
      });
    });

    $('button[name="button-excluir"]').click(function() {
      var currentId = $(this).attr('id');
      $.ajax({ 
        url: 'index.php?route=extension/itau_shopline/search/excluir&user_token={{ user_token }}&itaushopline_id=' +  currentId,
        dataType: 'json',
        beforeSend: function() {
          $(this).prop('disabled', true);
          $('#progress').html('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ text_excluindo }} <img src="view/image/itau_shopline/ajax-loader.gif" alt="" /><button type="button" class="close" data-dismiss="alert">&times;</button></div>');
          $('html, body').animate({ scrollTop: 0 }, 'slow');
        },
        complete: function() {
          $(this).prop('disabled', false);
        },
        success: function(json) {
          $('html, body').animate({ scrollTop: 0 }, 'slow');
          if (json['error']) {
            $('#progress').html('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + '<button type="button" class="close" data-dismiss="alert">&times;</button></div>');
          } else {
            $('.alert alert-danger').remove();
            $('#progress').html('<div class="alert alert-success"><i class="fa fa-check-circle"></i> ' + json['message'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
            location.href = location.href;
          }
        }
      });
    });
  //--></script>
</div>
{{ footer }}