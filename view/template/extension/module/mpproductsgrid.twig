{{ header }}{{ column_left }}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right">
        <button type="submit" form="form-mpproductsgrid" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i></button>
        <a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a></div>
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="container-fluid">
    {% if error_warning %}
    <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_edit }}</h3>
      </div>
      <div class="panel-body">
        <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-mpproductsgrid" class="form-horizontal">
          <ul class="nav nav-tabs">
            <li class="active"><a href="#tab-general" data-toggle="tab">{{ tab_general }}</a></li>
            <li class=""><a href="#tab-category" data-toggle="tab">{{ tab_category }}</a></li>
            <li class=""><a href="#tab-manufacturer" data-toggle="tab">{{ tab_manufacturer }}</a></li>
          </ul>
          <div class="tab-content">
            <div class="tab-pane active" id="tab-general">
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-name">{{ entry_name }}</label>
                <div class="col-sm-10">
                  <input type="text" name="name" value="{{ name }}" placeholder="{{ entry_name }}" id="input-name" class="form-control" />
                  {% if error_name %}
                  <div class="text-danger">{{ error_name }}</div>
                  {% endif %}
                </div>
              </div>
              {% if not module_id %}
                <div class="alert alert-info">{{ text_info }}</div>
              {% endif %}
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-status">{{ entry_status }}</label>
                <div class="col-sm-10">
                  <select name="status" id="input-status" class="form-control">
                    <option value="1" {% if status %}selected="selected"{% endif %}>{{ text_enabled }}</option>
                    <option value="0" {% if not status %}selected="selected"{% endif %}>{{ text_disabled }}</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-heading_title">{{ entry_heading_title }}</label>
                <div class="col-sm-10">
                  {% for language in languages %}
                  <div class="input-group"> <span class="input-group-addon"><img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" /></span>
                    <input type="text" name="pheading_title[{{ language.language_id }}]" value="{{ (pheading_title[language.language_id]) ? pheading_title[language.language_id] : '' }}" placeholder="{{ entry_heading_title }}" class="form-control" />
                  </div>
                  {% if (error_heading_title[language.language_id]) %}
                  <div class="text-danger">{{ error_name[language.language_id] }}</div>
                  {% endif %}
                  {% endfor %}
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{ entry_filter_display }}</label>
                <div class="col-sm-10">
                  <label class="radio-inline"><input type="radio" name="filter_display" value="0" {% if filter_display == '0' %}checked="checked"{% endif %} /> {{ text_filter_image }}</label>
                  <label class="radio-inline"><input type="radio" name="filter_display" value="1" {% if filter_display == '1' %}checked="checked"{% endif %} /> {{ text_filter_text }}</label>
                  <label class="radio-inline"><input type="radio" name="filter_display" value="2"  {% if filter_display == '2' %}checked="checked"{% endif %} /> {{ text_filter_both }}</label>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{ entry_show_product_name }}</label>
                <div class="col-sm-10">
                  <label class="radio-inline"><input type="radio" name="show_product_name" value="1" {% if show_product_name %}checked="checked"{% endif %} /> {{ text_yes }}</label>
                  <label class="radio-inline"><input type="radio" name="show_product_name" value="0" {% if not show_product_name %}checked="checked"{% endif %}/> {{ text_no }}</label>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{ entry_show_product_price }}</label>
                <div class="col-sm-10">
                  <label class="radio-inline"><input type="radio" name="show_product_price" value="1" {% if show_product_price %}checked="checked"{% endif %}/> {{ text_yes }}</label>
                  <label class="radio-inline"><input type="radio" name="show_product_price" value="0" {% if not show_product_price %}checked="checked"{% endif %}/> {{ text_no }}</label>
                </div>
              </div> 
              <div class="form-group">
                <label class="col-sm-2 control-label">{{ entry_show_product_description }}</label>
                <div class="col-sm-10">
                  <label class="radio-inline"><input type="radio" name="show_product_description" value="1" {% if show_product_description %}checked="checked"{% endif %}/> {{ text_yes }}</label>
                  <label class="radio-inline"><input type="radio" name="show_product_description" value="0" {% if not show_product_description %}checked="checked"{% endif %}/> {{ text_no }}</label>
                </div>
              </div>  
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-product_description_length"><span data-toggle="tooltip" title="{{ help_product_description_length }}">{{ entry_product_description_length }}</span></label>
                <div class="col-sm-10">
                  <input type="text" name="product_description_length" value="{{ product_description_length }}" placeholder="{{ entry_product_description_length }}" id="input-product_description_length" class="form-control" />
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{ entry_show_product_review }}</label>
                <div class="col-sm-10">
                  <label class="radio-inline"><input type="radio" name="show_product_review" value="1" {% if show_product_review %}checked="checked"{% endif %}/> {{ text_yes }}</label>
                  <label class="radio-inline"><input type="radio" name="show_product_review" value="0" {% if not show_product_review %}checked="checked"{% endif %}/>{{ text_no }}</label>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label"><span data-toggle="tooltip" title="{{ help_show_product_additional_images }}">{{ entry_show_product_additional_images }}</span></label>
                <div class="col-sm-10">
                  <label class="radio-inline"><input type="radio" name="show_product_additional_images" value="1" {% if show_product_additional_images %}checked="checked"{% endif %}/> {{ text_yes }}</label>
                  <label class="radio-inline"><input type="radio" name="show_product_additional_images" value="0" {% if not show_product_additional_images %}checked="checked"{% endif %}/> {{ text_no }}</label>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{ entry_show_prevnextbuttons }}</label>
                <div class="col-sm-10">
                  <label class="radio-inline"><input type="radio" name="show_prevnextbuttons" value="1" {% if show_prevnextbuttons %}checked="checked"{% endif %}/> {{ text_yes }}</label>
                  <label class="radio-inline"><input type="radio" name="show_prevnextbuttons" value="0" {% if not show_prevnextbuttons %}checked="checked"{% endif %}/> {{ text_no }}</label>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{ entry_show_pagedots }}</label>
                <div class="col-sm-10">
                  <label class="radio-inline"><input type="radio" name="show_pagedots" value="1" {% if show_pagedots %}checked="checked"{% endif %}/> {{ text_yes }}</label>
                  <label class="radio-inline"><input type="radio" name="show_pagedots" value="0" {% if not show_pagedots %}checked="checked"{% endif %}/> {{ text_no }}</label>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{ entry_slider_autoplay }}</label>
                <div class="col-sm-10">
                  <label class="radio-inline"><input type="radio" name="slider_autoplay" value="1" {% if slider_autoplay %}checked="checked"{% endif %}/> {{ text_yes }}</label>
                  <label class="radio-inline"><input type="radio" name="slider_autoplay" value="0" {% if not slider_autoplay %}checked="checked"{% endif %}/> {{ text_no }}</label>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{ entry_slider_pauseautoplayonhover }}</label>
                <div class="col-sm-10">
                  <label class="radio-inline"><input type="radio" name="slider_pauseautoplayonhover" value="1" {% if slider_pauseautoplayonhover %}checked="checked"{% endif %}/> {{ text_yes }}</label>
                  <label class="radio-inline"><input type="radio" name="slider_pauseautoplayonhover" value="0" {% if not slider_pauseautoplayonhover %}checked="checked"{% endif %}/> {{ text_no }}</label>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-slider_autoplayspeed"><span data-toggle="tooltip" title="{{ help_slider_autoplayspeed }}">{{ entry_slider_autoplayspeed }}</span></label>
                <div class="col-sm-10">
                  <input type="text" name="slider_autoplayspeed" value="{{ slider_autoplayspeed }}" placeholder="{{ entry_slider_autoplayspeed }}" id="input-slider_autoplayspeed" class="form-control" />
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-limit"><span data-toggle="tooltip" title="{{ help_limit }}">{{ entry_limit }}</span></label>
                <div class="col-sm-10">
                  <input type="text" name="limit" value="{{ limit }}" placeholder="{{ entry_limit }}" id="input-limit" class="form-control" />
                </div>
              </div>
            </div>
            <div class="tab-pane" id="tab-category">
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-category"><span data-toggle="tooltip" title="{{ help_category }}">{{ text_category }}</span></label>
                <div class="col-sm-10">
                  <input type="text" name="category" value="" placeholder="{{ text_category }}" id="input-category" class="form-control" />
                  <div id="grid-category" class="well well-sm" style="height: 150px; overflow: auto;">
                    {% for grid_category in grid_categories %}
                    <div data-id="{{ grid_category.category_id }}" id="grid-category{{ grid_category.category_id }}"><i class="fa fa-minus-circle"></i> {{ grid_category.name }}
                      <input type="hidden" name="grid_category[]" value="{{ grid_category.category_id }}" />
                    </div>
                    {% endfor %}
                  </div>
                </div>
                <div class="col-sm-12">
                   <div class="table-responsive">
                    <table id="categoryproducts" class="table table-bordered table-hover">
                      <thead>
                        <tr>
                          <td>{{ column_categoryname }}</td>
                          <td><span data-toggle="tooltip" title="{{ help_categoryproducts }}">{{ column_categoryproducts }}</span></td>
                          <td>{{ column_status }}</td>
                          <td>{{ column_sort_order }}</td>
                        </tr>
                      </thead>
                      <tbody>
                        {% for category_product in category_products %}
                        <tr id="categoryproduct-{{ category_product.category_id }}">
                          <td>{{ category_product.name }}</td>
                          <td>
                            <div class="col-sm-12">
                              <input type="text" name="categoryproduct" value="" placeholder="{{ column_categoryproducts }}" id="input-categoryproducts-{{ category_product.category_id }}" class="form-control" />
                              <div id="grid-categoryproducts{{ category_product.category_id }}" class="well well-sm" style="height: 150px; overflow: auto;">
                                  {% for highlightproducts in category_product.highlightproducts %}
                                  <div id="grid-categoryproducts{{ category_product.category_id }}-{{ highlightproducts.product_id }}"><i class="fa fa-minus-circle"></i> {{ highlightproducts.name }}
                                    <input type="hidden" name="grid_categoryproducts[{{ category_product.category_id }}][product_id][]" value="{{ highlightproducts.product_id }}" />
                                  </div>
                                  {% endfor %}
                              </div>
                            </div>  
                          </td>
                          <td>                            
                            <select name="grid_categoryproducts[{{ category_product.category_id }}][status]" id="input-categoryproduct-status-{{ category_product.category_id }}" class="form-control">
                              <option value="1" {% if category_product.status %}selected="selected"{% endif %}>{{ text_enabled }}</option>
                              <option value="0" {% if not category_product.status %}selected="selected"{% endif %}>{{ text_disabled }}</option>
                            </select>                            
                          </td>
                          <td><input type="text" name="grid_categoryproducts[{{ category_product.category_id }}][sort_order]" value="{{ category_product.sort_order }}" class="form-control" /></td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>      
                </div>
              </div>
            </div>
            <div class="tab-pane" id="tab-manufacturer">
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-manufacturer"><span data-toggle="tooltip" title="{{ help_manufacturer }}">{{ text_manufacturer }}</span></label>
                <div class="col-sm-10">
                  <input type="text" name="manufacturer" value="" placeholder="{{ text_manufacturer }}" id="input-manufacturer" class="form-control" />
                  <div id="grid-manufacturer" class="well well-sm" style="height: 150px; overflow: auto;">
                    {% for grid_manufacturer in grid_manufacturers %}
                    <div data-id="{{ grid_manufacturer.manufacturer_id }}" id="grid-manufacturer{{ grid_manufacturer.manufacturer_id }}"><i class="fa fa-minus-circle"></i> {{ grid_manufacturer.name }}
                      <input type="hidden" name="grid_manufacturer[]" value="{{ grid_manufacturer.manufacturer_id }}" />
                    </div>
                    {% endfor %}
                  </div>
                </div>
                <div class="col-sm-12">
                   <div class="table-responsive">
                    <table id="manufacturerproducts" class="table table-bordered table-hover">
                      <thead>
                        <tr>
                          <td>{{ column_manufacturername }}</td>
                          <td><span data-toggle="tooltip" title="{{ help_manufacturerproducts }}">{{ column_manufacturerproducts }}</span></td>
                          <td>{{ column_status }}</td>
                          <td>{{ column_sort_order }}</td>
                        </tr>
                      </thead>
                      <tbody>
                        {% for manufacturer_product in manufacturer_products %}
                        <tr id="manufacturerproduct-{{ manufacturer_product.manufacturer_id }}">
                          <td>{{ manufacturer_product.name }}</td>
                          <td>
                            <div class="col-sm-12">
                              <input type="text" name="manufacturerproduct" value="" placeholder="{{ column_manufacturerproducts }}" id="input-manufacturerproducts-{{ manufacturer_product.manufacturer_id }}" class="form-control" />
                              <div id="grid-manufacturerproducts{{ manufacturer_product.manufacturer_id }}" class="well well-sm" style="height: 150px; overflow: auto;">
                                  {% for highlightproducts in manufacturer_product.highlightproducts %}
                                  <div id="grid-manufacturerproducts{{ manufacturer_product.manufacturer_id }}-{{ highlightproducts.product_id }}"><i class="fa fa-minus-circle"></i> {{ highlightproducts.name }}
                                    <input type="hidden" name="grid_manufacturerproducts[{{ manufacturer_product.manufacturer_id }}][product_id][]" value="{{ highlightproducts.product_id }}" />
                                  </div>
                                  {% endfor %}
                              </div>
                            </div>  
                          </td>
                          <td>                            
                            <select name="grid_manufacturerproducts[{{ manufacturer_product.manufacturer_id }}][status]" id="input-manufacturerproduct-status-{{ manufacturer_product.manufacturer_id }}" class="form-control">
                              <option value="1" {% if manufacturer_product.status %}selected="selected"{% endif %}>{{ text_enabled }}</option>
                              <option value="0" {% if not manufacturer_product.status %}selected="selected"{% endif %}>{{ text_disabled }}</option>
                            </select>                            
                          </td>
                          <td><input type="text" name="grid_manufacturerproducts[{{ manufacturer_product.manufacturer_id }}][sort_order]" value="{{ manufacturer_product.sort_order }}" class="form-control" /></td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>      
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  <script type="text/javascript"><!--
$(function(){

  // Category
  $('input[name=\'category\']').autocomplete({
    'source': function(request, response) {
      $.ajax({
        url: 'index.php?route=catalog/category/autocomplete&user_token={{ user_token }}&filter_name=' +  encodeURIComponent(request),
        dataType: 'json',
        success: function(json) {
          response($.map(json, function(item) {
            return {
              label: item['name'],
              value: item['category_id']
            }
          }));
        }
      });
    },
    'select': function(item) {
      $('input[name=\'category\']').val('');

      $('#categoryproduct-'+item['value']).remove();
      $('#grid-category' + item['value']).remove();

      $('#grid-category').append('<div data-id="' + item['value'] + '" id="grid-category' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + '<input type="hidden" name="grid_category[]" value="' + item['value'] + '" /></div>');


      var html = '<tr id="categoryproduct-' + item['value'] + '">';
          html += ' <td><label>' + item['label'] + '</label></td>';
          html += ' <td><div class="col-sm-12"><input type="text" name="categoryproduct" value="" placeholder="{{ column_categoryproducts }}" id="input-categoryproducts-' + item['value'] + '" class="form-control" /><div id="grid-categoryproducts' + item['value'] + '" class="well well-sm" style="height: 150px; overflow: auto;"></div></div></td>';
          html += '<td><select name="grid_categoryproducts[' + item['value'] + '][status]" id="input-categoryproduct-status-' + item['value'] + '" class="form-control"><option value="1" selected="selected">{{ text_enabled }}</option><option value="0">{{ text_disabled }}</option></select></td>';
          html += '<td><input type="text" name="grid_categoryproducts[' + item['value'] + '][sort_order]" value="0" class="form-control" /></td>';
          html += '</tr>';


      $('#categoryproducts > tbody').append(html);
      
      categoryHighlightProducts(item['value']);
    }
  });

  $('#grid-category').delegate('.fa-minus-circle', 'click', function() {
    var category_id = $(this).parent().attr('data-id');
    $('#categoryproduct-'+category_id).remove();
    $(this).parent().remove();
  });

  // category highlight products

  $('#categoryproducts input[name=\'categoryproduct\']').each(function() {

    var category_id = $(this).attr('id').replace('input-categoryproducts-','');

    categoryHighlightProducts(category_id);

  });

  // Manufacturer
  $('input[name=\'manufacturer\']').autocomplete({
    'source': function(request, response) {
      $.ajax({
        url: 'index.php?route=catalog/manufacturer/autocomplete&user_token={{ user_token }}&filter_name=' +  encodeURIComponent(request),
        dataType: 'json',
        success: function(json) {
          response($.map(json, function(item) {
            return {
              label: item['name'],
              value: item['manufacturer_id']
            }
          }));
        }
      });
    },
    'select': function(item) {
      $('input[name=\'manufacturer\']').val('');

      $('#manufacturerproduct-'+item['value']).remove();
      $('#grid-manufacturer' + item['value']).remove();

      $('#grid-manufacturer').append('<div data-id="' + item['value'] + '" id="grid-manufacturer' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + '<input type="hidden" name="grid_manufacturer[]" value="' + item['value'] + '" /></div>');


      var html = '<tr id="manufacturerproduct-' + item['value'] + '">';
          html += ' <td><label>' + item['label'] + '</label></td>';
          html += ' <td><div class="col-sm-12"><input type="text" name="manufacturerproduct" value="" placeholder="{{ column_manufacturerproducts }}" id="input-manufacturerproducts-' + item['value'] + '" class="form-control" /><div id="grid-manufacturerproducts' + item['value'] + '" class="well well-sm" style="height: 150px; overflow: auto;"></div></div></td>';
          html += '<td><select name="grid_manufacturerproducts[' + item['value'] + '][status]" id="input-manufacturerproduct-status-' + item['value'] + '" class="form-control"><option value="1" selected="selected">{{ text_enabled }}</option><option value="0">{{ text_disabled }}</option></select></td>';
          html += '<td><input type="text" name="grid_manufacturerproducts[' + item['value'] + '][sort_order]" value="0" class="form-control" /></td>';
          html += '</tr>';


      $('#manufacturerproducts > tbody').append(html);
      
      manufacturerHighlightProducts(item['value']);
    }
  });

  $('#grid-manufacturer').delegate('.fa-minus-circle', 'click', function() {
    var manufacturer_id = $(this).parent().attr('data-id');
    $('#manufacturerproduct-'+manufacturer_id).remove();
    $(this).parent().remove();
  });

  // manufacturer highlight products

  $('#manufacturerproducts input[name=\'manufacturerproduct\']').each(function() {

    var manufacturer_id = $(this).attr('id').replace('input-manufacturerproducts-','');

    manufacturerHighlightProducts(manufacturer_id);

  });



});


function categoryHighlightProducts(category_id) {

  $('#input-categoryproducts-' + category_id).autocomplete({
    'source': function(request, response) {
      $.ajax({
        url: 'index.php?route=extension/module/mpproductsgrid/getProducts&user_token={{ user_token }}&filter_name=' +  encodeURIComponent(request) + '&filter_category_id=' +encodeURIComponent(category_id),
        dataType: 'json',
        success: function(json) {
          response($.map(json, function(item) {
            return {
              label: item['name'],
              value: item['product_id']
            }
          }));
        }
      });
    },
    'select': function(item) {
      $('#input-categoryproducts-'+category_id).val('');

      $('#grid-categoryproducts'+ category_id +'-' + item['value']).remove();

      $('#grid-categoryproducts'+ category_id).append('<div id="grid-categoryproducts'+ category_id +'-' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + '<input type="hidden" name="grid_categoryproducts['+ category_id +'][product_id][]" value="' + item['value'] + '" /></div>');
    }
  });

  $('#grid-categoryproducts'+ category_id).delegate('.fa-minus-circle', 'click', function() {

    $(this).parent().remove();
  });

}

function manufacturerHighlightProducts(manufacturer_id) {

  $('#input-manufacturerproducts-' + manufacturer_id).autocomplete({
    'source': function(request, response) {
      $.ajax({
        url: 'index.php?route=extension/module/mpproductsgrid/getProducts&user_token={{ user_token }}&filter_name=' +  encodeURIComponent(request) + '&filter_manufacturer_id=' +encodeURIComponent(manufacturer_id),
        dataType: 'json',
        success: function(json) {
          response($.map(json, function(item) {
            return {
              label: item['name'],
              value: item['product_id']
            }
          }));
        }
      });
    },
    'select': function(item) {
      $('#input-manufacturerproducts-'+manufacturer_id).val('');

      $('#grid-manufacturerproducts'+ manufacturer_id +'-' + item['value']).remove();

      $('#grid-manufacturerproducts'+ manufacturer_id).append('<div id="grid-manufacturerproducts'+ manufacturer_id +'-' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + '<input type="hidden" name="grid_manufacturerproducts['+ manufacturer_id +'][product_id][]" value="' + item['value'] + '" /></div>');
    }
  });

  $('#grid-manufacturerproducts'+ manufacturer_id).delegate('.fa-minus-circle', 'click', function() {

    $(this).parent().remove();
  });

}

//--></script></div>
{{ footer }}
